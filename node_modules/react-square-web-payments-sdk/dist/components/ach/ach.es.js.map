{"version":3,"file":"ach.es.js","sources":["../../../src/components/ach/ach.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { PayButton, SvgIcon } from './ach.styles';\nimport { transformPlaidEventName } from './ach.utils';\nimport type { AchProps, AchWithChildrenProps, AchWithoutChildrenProps, PlaidLinkOnEventMetadata } from './ach.types';\n\n/**\n * Renders a ACH button to use in the Square Web Payment SDK, pre-styled to meet\n * Square branding guidelines.\n *\n * **_But with the option to override styles or use a custom children_**\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <Ach />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nexport function Ach(props: AchWithChildrenProps): React.ReactElement;\nexport function Ach(props: AchWithoutChildrenProps): React.ReactElement;\nexport function Ach({\n  accountHolderName,\n  redirectURI,\n  transactionId,\n  callbacks,\n  buttonProps,\n  children,\n  svgProps,\n}: AchProps) {\n  const [ach, setAch] = React.useState<Square.ACH | undefined>(() => undefined);\n  const [isSubmitting, setIsSubmitting] = React.useState<boolean>(false);\n  const { cardTokenizeResponseReceived, payments } = useForm();\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n\n  /**\n   * Handle the on click of the ACH button click\n   *\n   * @param e An event which takes place in the DOM.\n   * @returns The data be sended to `cardTokenizeResponseReceived()` function, or an error\n   */\n  const handlePayment = async (e: Event) => {\n    e.stopPropagation();\n\n    if (!ach) {\n      console.warn('ACH button was clicked, but no ACH instance was found.');\n\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const result = await ach.tokenize({\n        accountHolderName,\n      });\n\n      if (result.status === 'OK') {\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\n        return tokenizedResult;\n      }\n\n      let message = `Tokenization failed with status: ${result.status}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n\n        throw new Error(message);\n      }\n\n      console.warn(message);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  React.useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const ach = await payments\n        ?.ach({\n          redirectURI,\n          transactionId,\n        })\n        .then((res) => {\n          if (signal?.aborted) {\n            return;\n          }\n\n          setAch(res);\n\n          return res;\n        });\n\n      if (signal.aborted) {\n        await ach?.destroy();\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [payments]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      ach?.addEventListener(\n        transformPlaidEventName(callback),\n        (callbacks as Record<string, (event: Square.SqEvent<PlaidLinkOnEventMetadata>) => void>)[callback]\n      );\n    }\n  }\n\n  useEventListener({\n    listener: handlePayment,\n    type: 'click',\n    element: buttonRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  const { isLoading, ...props } = buttonProps ?? {};\n  const disabled = isLoading || !ach || isSubmitting;\n\n  if (children) {\n    return (\n      <PayButton {...props} aria-disabled={disabled} disabled={disabled} ref={buttonRef} type=\"button\">\n        {children}\n      </PayButton>\n    );\n  }\n\n  return (\n    <PayButton {...props} aria-disabled={disabled} disabled={disabled} ref={buttonRef} type=\"button\">\n      <SvgIcon\n        fill=\"none\"\n        height=\"1em\"\n        viewBox=\"0 0 36 24\"\n        width=\"1em\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        {...svgProps}\n      >\n        <rect fill=\"url(#prefix__paint0_linear)\" height={24} rx={4} width={36} />\n        <path\n          clipRule=\"evenodd\"\n          d=\"M18.509 6.16a.89.89 0 00-1.018 0l-6.124 4.285a.848.848 0 00-.325.96.873.873 0 00.833.595h1.75v4.286h-1.75a.866.866 0 00-.875.857c0 .473.392.857.875.857h12.25a.866.866 0 00.875-.857.866.866 0 00-.875-.857h-1.75V12h1.75c.38 0 .717-.24.833-.596a.848.848 0 00-.324-.959L18.509 6.16zm2.116 10.126V12h-5.25v4.286h5.25zM18 7.91l3.395 2.376h-6.79L18 7.91z\"\n          fill=\"#fff\"\n          fillRule=\"evenodd\"\n        />\n        <defs>\n          <linearGradient gradientUnits=\"userSpaceOnUse\" id=\"prefix__paint0_linear\" x1={36} x2={0} y1={12} y2={12}>\n            <stop stopColor=\"#01D09E\" />\n            <stop offset={1} stopColor=\"#03E4AE\" />\n          </linearGradient>\n        </defs>\n      </SvgIcon>\n      <span>Pay with Direct debit (ACH)</span>\n    </PayButton>\n  );\n}\n\nexport default Ach;\nexport * from './ach.types';\n"],"names":[],"mappings":"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"}
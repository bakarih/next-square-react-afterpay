{"version":3,"file":"cash-app-pay.es.js","sources":["../../../src/components/cash-app-pay/cash-app-pay.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport type { CashAppPayProps } from './cash-app-pay.types';\n\nfunction CashAppPay({\n  callbacks,\n  id = 'rswps-cash-app-pay',\n  redirectURL,\n  referenceId,\n  shape = 'round',\n  size = 'medium',\n  values = 'dark',\n  width = 'static',\n  ...props\n}: CashAppPayProps) {\n  const [cashApp, setCashApp] = React.useState<Square.CashAppPay>();\n  const { createPaymentRequest, payments } = useForm();\n\n  const paymentRequestOptions: Square.CashAppPaymentRequestOptions = React.useMemo(\n    () => ({\n      redirectURL: redirectURL || window.location.href,\n      referenceId,\n    }),\n    [redirectURL, referenceId]\n  );\n\n  const options: Square.CashAppPayButtonOptions = React.useMemo(() => {\n    const baseOptions = {\n      shape,\n      size,\n      values,\n      width,\n    };\n\n    // if a value from options is undefined delete it from the options object\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\n      }\n\n      return acc;\n    }, {});\n  }, [shape, size, values, width]);\n\n  React.useEffect(() => {\n    if (!createPaymentRequest) {\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\n    }\n\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\n\n      if (!paymentRequest) {\n        throw new Error('`paymentRequest` is required when using digital wallets');\n      }\n\n      try {\n        const cashApp = await payments?.cashAppPay(paymentRequest, paymentRequestOptions).then((res) => {\n          if (signal?.aborted) {\n            return;\n          }\n\n          setCashApp(res);\n\n          return res;\n        });\n\n        await cashApp?.attach(`#${id}`, options);\n\n        if (signal.aborted) {\n          await cashApp?.destroy();\n        }\n      } catch (error) {\n        console.error('Initializing Cash App Pay failed', error);\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [createPaymentRequest, options, paymentRequestOptions, payments]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      cashApp?.addEventListener(\n        callback.toLowerCase() as 'ontokenization',\n        (callbacks as Record<string, (event: Square.SqEvent<Square.TokenizationEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  return <div {...props} id={id} />;\n}\n\nexport default CashAppPay;\nexport * from './cash-app-pay.types';\n"],"names":[],"mappings":"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"}
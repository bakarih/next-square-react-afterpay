{"version":3,"file":"cash-app-pay.cjs.js","sources":["../../../src/components/cash-app-pay/cash-app-pay.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport type { CashAppPayProps } from './cash-app-pay.types';\n\nfunction CashAppPay({\n  callbacks,\n  id = 'rswps-cash-app-pay',\n  redirectURL,\n  referenceId,\n  shape = 'round',\n  size = 'medium',\n  values = 'dark',\n  width = 'static',\n  ...props\n}: CashAppPayProps) {\n  const [cashApp, setCashApp] = React.useState<Square.CashAppPay>();\n  const { createPaymentRequest, payments } = useForm();\n\n  const paymentRequestOptions: Square.CashAppPaymentRequestOptions = React.useMemo(\n    () => ({\n      redirectURL: redirectURL || window.location.href,\n      referenceId,\n    }),\n    [redirectURL, referenceId]\n  );\n\n  const options: Square.CashAppPayButtonOptions = React.useMemo(() => {\n    const baseOptions = {\n      shape,\n      size,\n      values,\n      width,\n    };\n\n    // if a value from options is undefined delete it from the options object\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\n      }\n\n      return acc;\n    }, {});\n  }, [shape, size, values, width]);\n\n  React.useEffect(() => {\n    if (!createPaymentRequest) {\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\n    }\n\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\n\n      if (!paymentRequest) {\n        throw new Error('`paymentRequest` is required when using digital wallets');\n      }\n\n      try {\n        const cashApp = await payments?.cashAppPay(paymentRequest, paymentRequestOptions).then((res) => {\n          if (signal?.aborted) {\n            return;\n          }\n\n          setCashApp(res);\n\n          return res;\n        });\n\n        await cashApp?.attach(`#${id}`, options);\n\n        if (signal.aborted) {\n          await cashApp?.destroy();\n        }\n      } catch (error) {\n        console.error('Initializing Cash App Pay failed', error);\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [createPaymentRequest, options, paymentRequestOptions, payments]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      cashApp?.addEventListener(\n        callback.toLowerCase() as 'ontokenization',\n        (callbacks as Record<string, (event: Square.SqEvent<Square.TokenizationEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  return <div {...props} id={id} />;\n}\n\nexport default CashAppPay;\nexport * from './cash-app-pay.types';\n"],"names":["React","useForm"],"mappings":"ggBAQA,WAAoB,CAClB,YACA,KAAK,qBACL,cACA,cACA,QAAQ,QACR,OAAO,SACP,SAAS,OACT,QAAQ,YACL,GACe,CAClB,KAAM,CAAC,EAAS,GAAcA,EAAM,SAA4B,EAC1D,CAAE,uBAAsB,YAAaC,EAAQ,QAAA,EAE7C,EAA6DD,EAAM,QACvE,IAAO,EACL,YAAa,GAAe,OAAO,SAAS,KAC5C,aAEF,GAAA,CAAC,EAAa,CAAW,CAC3B,EAEM,EAA0CA,EAAM,QAAQ,IAAM,CAClE,KAAM,GAAc,CAClB,QACA,OACA,SACA,OAAA,EAIF,MAAO,QAAO,KAAK,CAAW,EAAE,OAAO,CAAC,EAA8B,IAChE,GAAY,KAAqC,QACnD,GAAI,GAAiB,EAAY,IAG5B,GACN,CAAE,CAAA,GACJ,CAAC,EAAO,EAAM,EAAQ,CAAK,CAAC,EA6C/B,GA3CAA,EAAM,UAAU,IAAM,CACpB,GAAI,CAAC,EACG,KAAA,IAAI,OAAM,iEAAiE,EAG7E,KAAA,GAAkB,GAAI,iBACtB,CAAE,UAAW,EA8BnB,MA5Bc,MAAO,IAAwB,CACrC,KAAA,GAAiB,GAAU,eAAe,CAAoB,EAEpE,GAAI,CAAC,EACG,KAAA,IAAI,OAAM,yDAAyD,EAGvE,GAAA,CACI,KAAA,GAAU,KAAM,IAAU,WAAW,EAAgB,CAAqB,EAAE,KAAK,AAAC,GAAQ,CAC9F,GAAI,IAAQ,QAIZ,SAAW,CAAG,EAEP,CAAA,CACR,EAED,KAAM,IAAS,OAAO,IAAI,IAAM,CAAO,EAEnC,EAAO,SACT,KAAM,IAAS,gBAEV,GACC,QAAA,MAAM,mCAAoC,CAAK,CACzD,CAAA,GAGI,CAAM,EAEL,IAAM,CACX,EAAgB,MAAM,CAAA,GAEvB,CAAC,EAAsB,EAAS,EAAuB,CAAQ,CAAC,EAE/D,EACF,SAAW,KAAY,QAAO,KAAK,CAAS,EAC1C,GAAS,iBACP,EAAS,YAAY,EACpB,EAAwF,EAC3F,EAIJ,MAAQA,GAAA,cAAA,MAAA,CAAK,GAAG,EAAO,IAAA,CAAQ,CACjC"}
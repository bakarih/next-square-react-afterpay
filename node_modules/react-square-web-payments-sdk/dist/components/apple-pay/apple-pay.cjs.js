"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var m=require("react"),v=require("../../contexts/form/form.cjs.js"),P=require("../../hooks/use-event-listener.cjs.js"),g=require("./apple-pay.styles.cjs.js");function h(t){if(t&&t.__esModule)return t;var n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return t&&Object.keys(t).forEach(function(e){if(e!=="default"){var a=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,a.get?a:{enumerable:!0,get:function(){return t[e]}})}}),n.default=t,Object.freeze(n)}var i=h(m);function j({id:t="rswps-apple-pay",...n}){const[e,a]=i.useState(()=>{}),{cardTokenizeResponseReceived:w,createPaymentRequest:l,payments:c}=v.useForm(),p=i.useRef(null),b=async s=>{if(s.stopPropagation(),!e){console.warn("Apple Pay button was clicked, but no Apple Pay instance was found.");return}try{const r=await e.tokenize();if(r.status==="OK")return w(r);let o=`Tokenization failed with status: ${r.status}`;if(r?.errors)throw o+=` and errors: ${JSON.stringify(r?.errors)}`,new Error(o);console.warn(o)}catch(r){console.error(r)}};return i.useEffect(()=>{if(!l)throw new Error("`createPaymentRequest()` is required when using digital wallets");const s=new AbortController,{signal:r}=s;return(async y=>{const f=c?.paymentRequest(l);if(!f)throw new Error("`paymentRequest` is required when using digital wallets");try{const u=await c?.applePay(f).then(d=>{if(!y?.aborted)return a(d),d});y.aborted&&await u?.destroy()}catch(u){console.error("Initializing Apple Pay failed",u)}})(r),()=>{s.abort()}},[l,c]),P.useEventListener({listener:b,type:"click",element:p,options:{passive:!0}}),i.createElement(g.ApplePayContainer,{...n,css:{display:e?"block":"none",opacity:e?1:.5,pointerEvents:e?"auto":"none",visibility:e?"visible":"hidden"},id:t,ref:p})}exports.default=j;
//# sourceMappingURL=apple-pay.cjs.js.map

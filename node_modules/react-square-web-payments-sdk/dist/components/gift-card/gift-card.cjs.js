"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var R=require("react"),_=require("../../contexts/form/form.cjs.js"),z=require("../../hooks/use-event-listener.cjs.js"),j=require("./gift-card.styles.cjs.js");function G(n){if(n&&n.__esModule)return n;var s=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return n&&Object.keys(n).forEach(function(o){if(o!=="default"){var c=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(s,o,c.get?c:{enumerable:!0,get:function(){return n[o]}})}}),s.default=n,Object.freeze(s)}var r=G(R);function k({buttonProps:n={id:"rswps-gift-card-button"},callbacks:s,children:o,focus:c,id:f="rswps-gift-card-container",includeInputLabels:d,render:b,style:g,...C}){const[u,h]=r.useState(()=>{}),[O,m]=r.useState(!1),{cardTokenizeResponseReceived:E,payments:w}=_.useForm(),y=r.useRef(null),S=r.useMemo(()=>{const e={includeInputLabels:d,style:g};return Object.keys(e).reduce((t,a)=>(e[a]!==void 0&&(t[a]=e[a]),t),{})},[d,g]),P=async e=>{if(e.stopPropagation(),!u){console.warn("Gift Card button was clicked, but no Gift Card instance was found.");return}m(!0);try{const t=await u?.tokenize();if(t.status==="OK")return await E(t);let a=`Tokenization failed with status: ${t.status}`;if(t?.errors)throw a+=` and errors: ${JSON.stringify(t?.errors)}`,new Error(a);console.warn(a)}catch(t){console.error(t)}finally{m(!1)}};if(r.useEffect(()=>{const e=new AbortController,{signal:t}=e;return(async i=>{const l=await w?.giftCard(S).then(p=>i.aborted?null:(h(p),p));await l?.attach(`#${f}`),c&&await l?.focus(c),i.aborted&&await l?.destroy()})(t),()=>{e.abort()}},[w,f]),s)for(const e of Object.keys(s))u?.addEventListener(e,s[e]);z.useEventListener({listener:P,type:"click",element:y,options:{passive:!0}});const v=({isLoading:e,...t})=>{const a="rswp-gift-card-button",i=e||!u||O;return r.createElement(j.PayButton,{...t,"aria-disabled":i,css:t?.css,disabled:i,id:a,ref:y,type:"button"},t?.children??"Pay with Gift Card")};return r.createElement(r.Fragment,null,r.createElement("div",{...C,"data-testid":"rswps-gift-card-container",id:f,style:{minHeight:89}},!u&&r.createElement(j.LoadingCard,null)),typeof b=="function"?b(v):r.createElement(v,{...n},o??"Pay with Gift Card"))}exports.default=k;
//# sourceMappingURL=gift-card.cjs.js.map

"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var z=require("react"),k=require("../../contexts/form/form.cjs.js"),M=require("../../hooks/use-event-listener.cjs.js"),O=require("./credit-card.styles.cjs.js");function q(n){if(n&&n.__esModule)return n;var i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return n&&Object.keys(n).forEach(function(c){if(c!=="default"){var o=Object.getOwnPropertyDescriptor(n,c);Object.defineProperty(i,c,o.get?o:{enumerable:!0,get:function(){return n[c]}})}}),i.default=n,Object.freeze(i)}var r=q(z);function L({buttonProps:n,callbacks:i,children:c,focus:o="cardNumber",id:l="rswps-card-container",includeInputLabels:f,postalCode:b,recalculateSize:m,render:y,style:v,...h}){const[s,C]=r.useState(()=>{}),[S,w]=r.useState(!1),g=r.useRef(null),{cardTokenizeResponseReceived:R,payments:p}=k.useForm(),_=r.useMemo(()=>{const t={includeInputLabels:f,postalCode:b,style:v};return Object.keys(t).reduce((e,a)=>(t[a]!==void 0&&(e[a]=t[a]),e),{})},[f,b,v]),P=async t=>{if(t.stopPropagation(),!n?.isLoading){if(!s){console.warn("Credit Card button was clicked, but no Credit Card instance was found.");return}w(!0);try{const e=await s.tokenize();if(e.status==="OK")return await R(e);let a=`Tokenization failed with status: ${e.status}`;if(e?.errors)throw a+=` and errors: ${JSON.stringify(e?.errors)}`,new Error(a);console.warn(a)}catch(e){console.error(e)}finally{w(!1)}}};if(r.useEffect(()=>{const t=new AbortController,{signal:e}=t;return(async d=>{const u=await p?.card(_).then(E=>d.aborted?null:(C(E),E));await u?.attach(`#${l}`),o&&await u?.focus(o),d.aborted&&await u?.destroy()})(e),()=>{t.abort()}},[p,l]),r.useEffect(()=>{s&&o&&s.focus(o)},[s,o]),i)for(const t of Object.keys(i))s?.addEventListener(t,i[t]);m&&m(s?.recalculateSize),M.useEventListener({listener:P,type:"click",element:g,options:{passive:!0}});const j=({children:t,isLoading:e,...a})=>{const d="rswp-card-button",u=e||!s||S;return r.createElement(O.PayButton,{...a,"aria-disabled":u,css:a?.css,disabled:u,id:d,ref:g,type:"button"},t??"Pay")};return r.createElement(r.Fragment,null,r.createElement("div",{...h,"data-testid":"rswps-card-container",id:l,style:{minHeight:89}},!s&&r.createElement(O.LoadingCard,null)),typeof y=="function"?y(j):r.createElement(j,{...n},c??"Pay"))}exports.default=L;
//# sourceMappingURL=credit-card.cjs.js.map

"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var h=require("react"),j=require("../../contexts/form/form.cjs.js"),q=require("../../hooks/use-event-listener.cjs.js"),O=require("./google-pay.styles.cjs.js");function R(t){if(t&&t.__esModule)return t;var s=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return t&&Object.keys(t).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}),s.default=t,Object.freeze(s)}var a=R(h);const E=({buttonColor:t,buttonSizeMode:s="fill",buttonType:n="long",id:i="rswps-google-pay-container",...p})=>{const[c,v]=a.useState(()=>{}),{cardTokenizeResponseReceived:P,createPaymentRequest:u,payments:f}=j.useForm(),g=a.useRef(null),y=a.useMemo(()=>{const r={buttonColor:t,buttonSizeMode:s,buttonType:n};return Object.keys(r).reduce((e,o)=>(r[o]!==void 0&&(e[o]=r[o]),e),{})},[t,s,n]),b=async r=>{if(r.stopPropagation(),!c){console.warn("Google Pay button was clicked, but no Google Pay instance was found.");return}try{const e=await c.tokenize();if(e.status==="OK")return P(e);let o=`Tokenization failed with status: ${e.status}`;if(e?.errors)throw o+=` and errors: ${JSON.stringify(e?.errors)}`,new Error(o);console.warn(o)}catch(e){console.error(e)}};return a.useEffect(()=>{if(!u)throw new Error("`createPaymentRequest()` is required when using digital wallets");const r=new AbortController,{signal:e}=r;return(async d=>{const w=f?.paymentRequest(u);if(!w)throw new Error("`paymentRequest` is required when using digital wallets");try{const l=await f?.googlePay(w).then(m=>{if(!d?.aborted)return v(m),m});await l?.attach(`#${i}`,y),d.aborted&&await l?.destroy()}catch(l){console.error("Initializing Google Pay failed",l)}})(e),()=>{r.abort()}},[u,f,y]),q.useEventListener({listener:b,type:"click",element:g,options:{passive:!0}}),a.createElement("div",{...p,id:i,ref:g},c?null:a.createElement(O.ButtonLoader,null))};exports.default=E;
//# sourceMappingURL=google-pay.cjs.js.map
